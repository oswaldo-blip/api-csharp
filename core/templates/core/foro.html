{% load static %}
<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <!-- Favicon -->
  <link rel="shortcut icon" type="image/x-icon" href="{% static 'core/images/favicon.ico' %}">

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;600;700&display=swap" rel="stylesheet">

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="{% static 'core/css/bootstrap.min.css' %}">

  <!-- Custom CSS -->
  <link rel="stylesheet" href="{% static 'core/css/estilos.css' %}">

  <title>Sowknet | Foro</title>
</head>

<body>

<!-- Tawk.to Script -->
<script type="text/javascript">
  var Tawk_API = Tawk_API || {}, Tawk_LoadStart = new Date();
  (function () {
    var s1 = document.createElement("script"), s0 = document.getElementsByTagName("script")[0];
    s1.async = true;
    s1.src = 'https://embed.tawk.to/681ad679062127190b81ea35/1iqkdbipe';
    s1.charset = 'UTF-8';
    s1.setAttribute('crossorigin', '*');
    s0.parentNode.insertBefore(s1, s0);
  })();
</script>

<!-- NAVBAR -->
<nav class="navbar navbar-dark bg-primary navbar-expand-md fixed-top">
  <div class="container">
    <a href="{% url 'index' %}" class="navbar-brand">
      <img src="{% static 'core/images/logo_3.png' %}" alt="Logo Sowknet" class="img-fluid" style="max-height: 80px;">
    </a>

    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#menu-principal" aria-controls="menu-principal" aria-expanded="false" aria-label="Menú de navegación">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="menu-principal">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item"><a href="{% url 'index' %}" class="nav-link">Inicio</a></li>
        <li class="nav-item"><a href="{% url 'nosotros' %}" class="nav-link">Nosotros</a></li>
        <li class="nav-item"><a href="{% url 'contenido' %}" class="nav-link">Contenido</a></li>
        <li class="nav-item"><a href="{% url 'foro' %}" class="nav-link active">Foro</a></li>
        <li class="nav-item"><a href="{% url 'encuesta' %}" class="nav-link">Encuesta</a></li>
      </ul>
    </div>
  </div>
</nav>

<!-- FORO DE OPINIÓN -->
 <br>
 <br>
 <br>
<div class="container pt-5 mt-5">
  <div class="row mb-5">
    <div class="col-12">
      <div class="foro-contenedor p-4 bg-white border rounded shadow-sm h-100">
        <h2 class="text-center text-primary mb-4">Foro de Opinión</h2>
        <h4 class="mb-3">Comparte tu experiencia:</h4>

        <form id="formComentario" method="post" action="{% url 'guardar_comentario' %}" class="mb-4">
        {% csrf_token %}
        <div class="mb-3">
        <input type="text" id="nombre" name="nombre" class="form-control" placeholder="Tu nombre" required>
        </div>
        <div class="mb-3">
        <textarea id="mensaje" name="mensaje" class="form-control" rows="3" placeholder="Escribe tu comentario aquí..." required></textarea>
        </div>
        <button type="submit" class="btn btn-primary">Publicar</button>
        </form>


        <div id="foro">
          <!-- Comentarios aparecerán aquí -->
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Script para manejar comentarios -->
<script>
  const form = document.getElementById("formComentario");
  const foro = document.getElementById("foro");

  form.addEventListener("submit", function (e) {
    e.preventDefault();
    const formData = new FormData(form);
    fetch(form.action, {
      method: "POST",
      headers: {
        'X-CSRFToken': form.querySelector('[name=csrfmiddlewaretoken]').value
      },
      body: formData
    })
    .then(response => response.json())
    .then(data => {
      if (data.nombre && data.mensaje) {
        const nuevoComentario = crearComentario(data.nombre, data.mensaje);
        foro.prepend(nuevoComentario);
        form.reset();
      }
    })
    .catch(error => console.error('Error:', error));
  });

  function crearComentario(nombre, texto) {
    const div = document.createElement("div");
    div.className = "comentario border p-2 mb-2 rounded bg-light";
    div.innerHTML = `
      <strong>${nombre}:</strong>
      <p>${texto}</p>
      <button class="btn btn-sm btn-link">Responder</button>
      <div class="respuestas ms-3 mt-2"></div>
    `;
    const btn = div.querySelector("button");
    btn.addEventListener("click", () => mostrarFormularioRespuesta(div.querySelector(".respuestas")));
    return div;
  }

  function mostrarFormularioRespuesta(contenedor) {
    if (contenedor.querySelector("form")) return;
    const form = document.createElement("form");
    form.innerHTML = `
      <textarea class="form-control mb-1" rows="2" placeholder="Tu respuesta..." required></textarea>
      <button type="submit" class="btn btn-sm btn-success">Enviar</button>
    `;
    form.addEventListener("submit", e => {
      e.preventDefault();
      const texto = form.querySelector("textarea").value.trim();
      if (texto) {
        const respuesta = document.createElement("div");
        respuesta.className = "respuesta bg-white p-2 mb-2 rounded border";
        respuesta.innerHTML = `<p>${texto}</p>`;
        contenedor.appendChild(respuesta);
        form.remove();
      }
    });
    contenedor.appendChild(form);
  }
</script>

<!-- FOOTER -->
 <br>
 <br>
 <br>
 <br>
 <br>
<footer class="pie-de-pagina text-center text-md-start bg-dark text-white mt-5">
  <div class="container">
    <p class="m-0 py-3">Copyright © 2025. Todos los derechos reservados.</p>
  </div>
</footer>

<!-- JS de Bootstrap -->
<script src="{% static 'core/js/jquery-3.7.1.min.js' %}"></script>
<script src="{% static 'core/js/popper.min.js' %}"></script>
<script src="{% static 'core/js/bootstrap.min.js' %}"></script>

</body>
</html>
